!function(t){function e(e){for(var a,o,r=e[0],c=e[1],u=e[2],p=0,d=[];p<r.length;p++)o=r[p],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&d.push(i[o][0]),i[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);for(l&&l(e);d.length;)d.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],a=!0,r=1;r<n.length;r++){var c=n[r];0!==i[c]&&(a=!1)}a&&(s.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},i={7:0},s=[];function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var r=window.webpackJsonp=window.webpackJsonp||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var u=0;u<r.length;u++)e(r[u]);var l=c;s.push([5,1,0]),n()}({2642:function(t,e,n){t.exports=n.p+"img/delete.f973ab1a.svg"},"2ba4":function(t,e,n){},4618:function(t,e,n){t.exports=n.p+"img/upload.c8e7e6e3.svg"},5:function(t,e,n){t.exports=n("c38f")},5636:function(t,e,n){"use strict";var a=n("2ba4");n.n(a).a},c38f:function(t,e,n){"use strict";n.r(e),n("cadf"),n("551c"),n("f751"),n("097d");var a=n("22b4"),i=(n("7f7f"),n("28a5"),n("6b54"),n("96cf"),n("1da1")),s=n("c1df"),o=n.n(s),r=n("3452"),c=n.n(r),u=n("82ea"),l=n("28a2"),p=n("b681"),d=n("3f52"),f=n("49e5"),m=n("b199"),v={components:{headerBetween:p.a,BaseButton:u.a},data:function(){return{name:"",classId:"",isContinuous:!0,continuousDays:"",beginDate:new Date,endDate:new Date,desc:"",options:[{name:"连续",value:!0},{name:"单次",value:!1}],minDate:new Date(2020,0,1),maxDate:new Date(2030,12,31),currentDate:null,dateType:"",isContinuousVisible:!1,beginDateVisible:!1,endDateVisible:!1,activeUpIndex:0,upList:[{name:"图片",value:"img"},{name:"视频",value:"video"}],upFileList:[{url:"https://img.yzcdn.cn/vant/leaf.jpg"}],cos:void 0,userInfo:void 0,uploadShow:!1,currentRate:0,video:"",maxUpImgNum:9,upImgList:[]}},created:function(){this.classId=api.pageParam.data.id,this.getUserInfo()},methods:{initCosSync:function(){var t=Object(i.a)(regeneratorRuntime.mark((function t(){var e,n,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(f.c)();case 3:e=t.sent,n=c.a.AES.decrypt(e.value,c.a.enc.Utf8.parse(this.userInfo.id),{iv:c.a.enc.Utf8.parse(""),mode:c.a.mode.ECB,padding:c.a.pad.Pkcs7}),a=JSON.parse(n.toString(c.a.enc.Utf8)),this.cos=api.require("tencentCos"),this.cos.init({appId:a.a,secretId:a.k,secretKey:a.s,regionName:"ap-nanjing"},(function(t,e){t||api.toast({msg:JSON.stringify(e),duration:2e3,location:"bottom"})})),t.next=12;break;case 10:t.prev=10,t.t0=t.catch(0);case 12:case"end":return t.stop()}}),t,this,[[0,10]])})));return function(){return t.apply(this,arguments)}}(),imagePreview:function(t){Object(l.a)({images:this.upImgList,startPosition:t})},upImg:function(){var t=Object(i.a)(regeneratorRuntime.mark((function t(){var e,n,a,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$checkSystemAccess("photos","相册");case 2:if(!t.sent){t.next=10;break}return t.next=6,this.$getPic();case 6:e=t.sent,n="."+e.data.split(".").pop().toLowerCase(),a=this.userInfo.id+(new Date).getTime(),this.cos&&this.cos.uploadObject({bucket:"yiqitao-video-1303909371",key:"imgs/"+a+n,path:e.data},(function(t,e){if(t.eventType&&"onProgress"==t.eventType&&(i.currentRate=t.currentSize/t.totalSize*100),t.status){i.uploadShow=!1;var n=i.upImgList;n.length<i.maxUpImgNum&&(i.upImgList.push("https://yiqitao-video-1303909371.cos.ap-nanjing.myqcloud.com/".concat(t.key)),i.upImgList=n)}e&&(i.uploadShow=!1,i.$toast.fail("上传失败"))}));case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),deleteImg:function(t){var e=this;this.$dialog.confirm({title:"确认删除",message:"确认删除该图片？"}).then((function(n){e.upImgList.splice(t,1)})).catch((function(t){}))},getUserInfo:function(){var t=this;Object(d.e)().then((function(e){t.userInfo=e.value,t.initCosSync()})).catch((function(t){}))},upVideo:function(){var t=Object(i.a)(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$checkSystemAccess("photos","相册和多媒体");case 2:t.sent&&api.getPicture({sourceType:"album",mediaValue:"video",destinationType:"base64",allowEdit:!0,quality:50,videoQuality:"",targetWidth:100,targetHeight:100,saveToPhotoAlbum:!1},(function(t,n){t?t.data?(e.uploadShow=!0,e.currentRate=0,e.cos&&e.cos.uploadObject({bucket:"yiqitao-video-1303909371",key:"video/"+e.userInfo.id+".mp4",path:t.data},(function(t,n){t.eventType&&"onProgress"==t.eventType&&(e.currentRate=t.currentSize/t.totalSize*100),t.status&&(e.uploadShow=!1,e.video="https://yiqitao-video-1303909371.cos.ap-nanjing.myqcloud.com/".concat(t.key,"?flag=").concat(Math.random()),e.$toast.success("上传成功")),n&&(e.uploadShow=!1,e.$toast.fail("上传失败"))}))):api.toast({msg:"未选择文件",duration:2e3,location:"bottom"}):alert(JSON.stringify(n))}));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),showActionSheet:function(t){this[t]=!0},onSelect:function(t){this.isContinuous=t.value,this.isContinuousVisible=!1},onBeginDateConfirm:function(t){this.beginDate=t,this.beginDateVisible=!1},onBeginDateCancel:function(){this.beginDateVisible=!1},onEndDateConfirm:function(t){this.endDate=t,this.endDateVisible=!1;var e=o()(this.beginDate).format("YYYY-MM-DD").toString().substr(8),n=o()(t).format("YYYY-MM-DD").toString().substr(8)-e+1;this.continuousDays=n},onEndDateCancel:function(){this.endDateVisible=!1},formatter:function(t,e){return"".concat(e,"year"===t?"年":"month"===t?"月":"日")},submit:function(){var t=Object(i.a)(regeneratorRuntime.mark((function t(){var e,n,a,i,s,r,c,u,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.name,n=this.classId,a=this.isContinuous,i=this.continuousDays,s=this.beginDate,r=this.endDate,c=this.desc,e){t.next=5;break}this.$toast.fail("请输入作业名称"),t.next=31;break;case 5:if(i||!a){t.next=9;break}this.$toast.fail("请输入连续天数"),t.next=31;break;case 9:if(c){t.next=13;break}this.$toast.fail("请输入内容描述"),t.next=31;break;case 13:return s=o()(s).format("YYYY-MM-DD"),u={name:e,classId:n,isContinuous:a,continuousDays:i,beginDate:s,desc:c},!a&&(u.endDate=r),0===this.activeUpIndex?u.imgs=this.upImgList.toString():u.video=this.video,t.prev=17,t.next=20,Object(m.c)(u);case 20:if(l=t.sent,l.success){t.next=24;break}return t.abrupt("return");case 24:api.toast({msg:"发布成功",global:!0}),api.sendEvent({name:"createTask"}),api.closeWin(),t.next=31;break;case 29:t.prev=29,t.t0=t.catch(17);case 31:case"end":return t.stop()}}),t,this,[[17,29]])})));return function(){return t.apply(this,arguments)}}(),handleClick:function(t){this.activeUpIndex=t}}},h=(n("5636"),n("2877")),b=Object(h.a)(v,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("headerBetween",{attrs:{leftType:"",leftText:"发布作业"}}),a("div",{staticClass:"content"},[a("van-field",{attrs:{label:"作业名称",placeholder:"请输入作业名称","input-align":"right"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),a("van-cell",{attrs:{title:"作业类型","is-link":"",value:t.isContinuous?"连续":"单次"},on:{click:function(e){return t.showActionSheet("isContinuousVisible")}}}),a("van-action-sheet",{attrs:{actions:t.options},on:{select:t.onSelect},model:{value:t.isContinuousVisible,callback:function(e){t.isContinuousVisible=e},expression:"isContinuousVisible"}}),a("van-cell",{attrs:{title:"开始日期","is-link":"",value:t._f("commonDate")(t.beginDate)},on:{click:function(e){return t.showActionSheet("beginDateVisible")}}}),a("van-popup",{style:{height:"30%"},attrs:{round:"",position:"bottom"},model:{value:t.beginDateVisible,callback:function(e){t.beginDateVisible=e},expression:"beginDateVisible"}},[a("van-datetime-picker",{attrs:{type:"date",title:"选择开始日期","min-date":t.minDate,"max-date":t.maxDate,formatter:t.formatter},on:{confirm:t.onBeginDateConfirm,cancel:t.onBeginDateCancel},model:{value:t.beginDate,callback:function(e){t.beginDate=e},expression:"beginDate"}})],1),t.isContinuous?t._e():a("van-cell",{attrs:{title:"结束日期","is-link":"",value:t._f("commonDate")(t.endDate)},on:{click:function(e){return t.showActionSheet("endDateVisible")}}}),a("van-popup",{style:{height:"30%"},attrs:{round:"",position:"bottom"},model:{value:t.endDateVisible,callback:function(e){t.endDateVisible=e},expression:"endDateVisible"}},[a("van-datetime-picker",{attrs:{type:"date",title:"选择结束日期","min-date":t.minDate,"max-date":t.maxDate,formatter:t.formatter},on:{confirm:t.onEndDateConfirm,cancel:t.onEndDateCancel},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}})],1),t.isContinuous?a("van-field",{attrs:{label:"连续天数",placeholder:"请输入连续天数","input-align":"right"},model:{value:t.continuousDays,callback:function(e){t.continuousDays=e},expression:"continuousDays"}}):t._e(),a("van-field",{attrs:{label:"内容描述",autosize:"",type:"textarea",maxlength:"200","show-word-limit":"",rows:"3",placeholder:"请输入内容描述","input-align":"right"},model:{value:t.desc,callback:function(e){t.desc=e},expression:"desc"}}),a("div",{staticClass:"up-media"},[a("div",{staticClass:"top-operate"},[a("div",{staticClass:"left"},[t._v("上传文件")]),a("div",{staticClass:"right"},t._l(t.upList,(function(e,n){return a("span",{key:n,staticClass:"right-item",class:{active:n===t.activeUpIndex},on:{click:function(e){return t.handleClick(n)}}},[t._v(t._s(e.name))])})),0)]),a("div",{staticClass:"operate-content"},[0===t.activeUpIndex?a("div",{staticClass:"img-wrap"},[t._l(t.upImgList,(function(e,i){return a("div",{staticClass:"item-wrap"},[a("div",{staticClass:"wrap"},[a("img",{staticClass:"img-delete",attrs:{src:n("2642"),alt:""},on:{click:function(e){return t.deleteImg(i)}}}),a("img",{staticClass:"img-up",attrs:{src:e,alt:""},on:{click:function(e){return t.imagePreview(i)}}})])])})),t.upImgList.length<t.maxUpImgNum?a("div",{staticClass:"item-wrap"},[a("div",{staticClass:"wrap"},[a("img",{staticClass:"holder-up",attrs:{src:n("4618"),alt:""},on:{click:t.upImg}})])]):t._e()],2):a("div",{staticClass:"video-wrap"},[t.video?a("video",{attrs:{controls:"",controlsList:"nodownload",poster:n("d356"),src:t.video}}):t._e(),a("div",{staticClass:"up-video-btn",on:{click:t.upVideo}},[a("BaseButton",{staticClass:"btn-style",attrs:{name:t.video?"重新上传":"上传视频"},on:{click:t.upVideo}})],1)])])]),a("div",{staticClass:"button mar-top",on:{click:t.submit}},[t._v("发布作业")])],1),a("van-popup",{attrs:{closeable:!1,"close-on-click-overlay":!1},model:{value:t.uploadShow,callback:function(e){t.uploadShow=e},expression:"uploadShow"}},[a("van-circle",{attrs:{rate:0,clockwise:!1,speed:100},model:{value:t.currentRate,callback:function(e){t.currentRate=e},expression:"currentRate"}},[a("div",{staticClass:"poup-center-text"},[t._v("\n        视频上传中"),a("br"),t._v(" "+t._s(t.currentRate.toFixed(2))+"%\n      ")])])],1)],1)}),[],!1,null,"eeb26a98",null).exports;new a.a({el:"#app",render:function(t){return t(b)}})}});